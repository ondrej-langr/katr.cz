(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[404],{29078:function(e,t,r){var n=r(17297),o=r(56974),a=r(62721),i=r(33812);e.exports=function(e,t){return t=n(t,e),null==(e=a(e,t))||delete e[i(o(t))]}},62721:function(e,t,r){var n=r(99250),o=r(39872);e.exports=function(e,t){return t.length<2?e:n(e,o(t,0,-1))}},56974:function(e){e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},17195:function(e,t,r){var n=r(29078);e.exports=function(e,t){return null==e||n(e,t)}},80404:function(e,t,r){"use strict";r.d(t,{Z:function(){return ve}});var n=r(94776),o=r.n(n),a=r(52322),i=r(33792),s=r(85812),u=r(33965),c=r(5632),l=r(2784);function d(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,o)}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){f(e,t,r[t])}))}return e}var v,b=(0,l.createContext)({view:"create",isLoading:!0,exitView:function(){},mutateUser:(v=o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)})),function(){var e=this,t=arguments;return new Promise((function(r,n){var o=v.apply(e,t);function a(e){d(o,r,n,a,i,"next",e)}function i(e){d(o,r,n,a,i,"throw",e)}a(void 0)}))})}),m=function(){return(0,l.useContext)(b)},g=r(30621),y=r(49898),h=r(63955),w=r(18362),x=r(33972),j=r(8168),O=r(17195),k=r.n(O);function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){P(e,t,r[t])}))}return e}var N=function(){var e=m().model,t=(0,j.bN)(),r=t.currentUserIsAdmin,n=t.currentUser,o=(0,h.Gc)().formState,i=(0,l.useMemo)((function(){if(e){var t=S({},e,{columns:S({},e.columns)});return t.columns.role&&!r&&(null===n||void 0===n?void 0:n.role)!==w.vX.Maintainer&&k()(t,"columns.role"),(0,x.x)(t)}}),[e,r,n]);return(0,a.jsxs)(a.Fragment,{children:[i&&(0,a.jsx)(x.Z,{fields:i}),o.isSubmitting&&(0,a.jsx)("div",{className:"absolute inset-0 cursor-progress bg-white/20 backdrop-blur-[2px]"})]})},U=r(52829),E=function(){var e=m().view,t=(0,U.$)().t;return(0,a.jsx)("header",{className:"mr-9 w-full border-b-2 border-project-border pb-5 xl:mr-0",children:(0,a.jsx)("h1",{className:"m-0 text-5xl font-bold",children:t("update"==e?"Update an user":"Create an user")})})},A=r(1571),C=r(89673),R=r(72722),I=r(6277),D=r(52170),M=r(5386),T=r(35817),L=r(53610),Z=r(85409),V=r(24917),$=r(58532),_=Object.defineProperty,B=Object.getOwnPropertySymbols,X=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,z=(e,t,r)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,q=(e,t)=>{for(var r in t||(t={}))X.call(t,r)&&z(e,r,t[r]);if(B)for(var r of B(t))K.call(t,r)&&z(e,r,t[r]);return e};var G=r(97470);function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function H(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,o)}function J(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){H(a,n,o,i,s,"next",e)}function s(e){H(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Q(e,t,r[t])}))}return e}function Y(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,s=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(u){s=!0,o=u}finally{try{i||null==r.return||r.return()}finally{if(s)throw o}}return a}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return F(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return F(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var te=function(e){var t=e.className,r=Y(e,["className"]);return(0,a.jsx)(C.Z,W({className:(0,I.Z)("relative top-0.5 inline-block h-4",t)},r))},re=function(){var e=m(),t=e.isLoading,r=e.view,n=e.user,i=e.exitView,s=(e.model,e.mutateUser),c=(0,h.Gc)(),d=c.watch,f=c.formState.isSubmitting,p=(0,j.bN)(),v=p.currentUserIsAdmin,b=p.currentUser,g=d(),y=(0,T.o)(),x=(0,U.$)().t,O=(0,G.$)(),k=ee(function(e){const[t,r]=(0,l.useState)(e);return[t,e=>r((t=>q(q({},t),"function"===typeof e?e(t):e)))]}({isSendingPasswordReset:!1,isTogglingBlock:!1}),2),P=k[0],S=k[1],N=(0,l.useMemo)((function(){return"update"!==r||!!Object.keys((0,M.d$)(n||{},g)).length}),[g,r,n]),E=function(){var e=J(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm(x(D.X3.ON_DELETE_REQUEST_PROMPT))){e.next=4;break}return i(),e.next=4,u.Uq.delete({id:null===n||void 0===n?void 0:n.id,model:"users"});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=J(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S({isSendingPasswordReset:!0}),t=(null===n||void 0===n?void 0:n.state)===w.V7.passwordReset,e.prev=2,e.next=5,O({title:x("Password reset"),message:x(t?"Resending password reset email":"Sending user password reset email"),successMessage:x("User can now follow instruction in their email")},J(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.KD.requestPasswordReset(n.id);case 2:return t=e.sent,e.next=5,s((function(e){var r;if(e&&(null===(r=t.data)||void 0===r?void 0:r.data))return W({},e,t.data.data)}),{revalidate:!1});case 5:case"end":return e.stop()}}),e)}))));case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:S({isSendingPasswordReset:!1});case 10:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=J(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S({isTogglingBlock:!0}),t=n.state===w.V7.blocked,e.prev=2,e.next=5,O({title:x(t?"Unblocking":"Blocking"),message:"",successMessage:x(t?"User is now unblocked":"User is now blocked")},J(o().mark((function e(){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.KD.toggleBlock(n.id,t);case 2:return r=e.sent,e.next=5,s((function(e){var t;if(e&&(null===(t=r.data)||void 0===t?void 0:t.data))return W({},e,r.data.data)}),{revalidate:!1});case 5:case"end":return e.stop()}}),e)}))));case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:S({isTogglingBlock:!1});case 10:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(){return e.apply(this,arguments)}}();return(0,a.jsxs)("aside",{className:(0,I.Z)(y.aside,"sticky top-0 grid gap-5"),children:[(0,a.jsxs)(R.Z,{className:"!pt-0",title:"Apply changes",children:["update"===r&&(0,a.jsx)("div",{className:(0,I.Z)("w-full bg-white py-5 px-4"),children:(0,a.jsx)("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:(0,a.jsxs)("li",{children:[x("State"),":"," ",t?(0,a.jsx)(te,{className:"w-full max-w-[6rem]"}):(0,a.jsx)("span",{className:"font-semibold text-blue-600",children:null===n||void 0===n?void 0:n.state})]})})}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-5 border-t-2 border-project-border px-4 py-4",children:["update"===r?(0,a.jsx)(Z.A,{size:"lg",type:"button",loading:f,onClick:E,color:"red",variant:"light",className:(0,I.Z)(f&&"!cursor-progress","text-sm text-red-500"),children:(0,a.jsx)(L.R.Trash,{className:"aspect-square w-5"})}):(0,a.jsx)("span",{}),(0,a.jsx)(V.z,{size:"lg",color:"green",type:"submit",disabled:f||!N,loading:f,className:(0,I.Z)(f&&"!cursor-progress"),children:x(f?"create"===r?"Creating...":"Updating...":"create"===r?"Create":"Update")})]})]}),"update"===r&&(v||(null===b||void 0===b?void 0:b.role)===w.vX.Maintainer)&&(0,a.jsx)(R.Z,{title:x("Actions"),children:(0,a.jsxs)($.M,{cols:1,className:"p-5",children:[(0,a.jsx)(V.z,{loading:P.isSendingPasswordReset,disabled:!n||(null===n||void 0===n?void 0:n.state)===w.V7.blocked,onClick:A,children:x((null===n||void 0===n?void 0:n.state)===w.V7.passwordReset?"Resend password reset":"Send password reset")}),(0,a.jsx)(V.z,{loading:P.isTogglingBlock,disabled:!n,color:"red",onClick:C,children:x((null===n||void 0===n?void 0:n.state)===w.V7.blocked?"Unblock user":"Block user")})]})})]})},ne=r(89644),oe=r.n(ne);function ae(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,o)}function ie(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ae(a,n,o,i,s,"next",e)}function s(e){ae(a,n,o,i,s,"throw",e)}i(void 0)}))}}function se(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){se(e,t,r[t])}))}return e}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function le(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function de(e){return function(e){if(Array.isArray(e))return ce(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return ce(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ce(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var fe=function(e){var t=e.children,r=(0,h.Gc)().handleSubmit,n=function(){var e=(0,c.useRouter)().push,t=m(),r=t.view,n=t.user,a=t.mutateUser,i=(0,G.$)(),s=(0,U.$)().t,l=(0,h.Gc)().setError,d=function(){var t=ie(o().mark((function t(c){var d;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i({title:"update"===r?"Updating":"Creating",message:s("update"===r?"Updating user data, please wait":"Creating new user, please wait"),successMessage:s("update"===r?"User data has been updated!":"New user has been created!"),errorMessage:function(e){var t;return oe().isAxiosError(e)&&409===(null===(t=e.response)||void 0===t?void 0:t.status)?s(D.X3.DUPLICATE_USER):s(D.X3.ERROR_BASIC)}},ie(o().mark((function t(){var i,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("update"!==r){t.next=8;break}return t.next=3,u.KD.update(null===n||void 0===n?void 0:n.id,(0,M.d$)(n,c));case 3:return i=t.sent,t.next=6,a((function(e){var t;if(e&&(null===i||void 0===i||null===(t=i.data)||void 0===t?void 0:t.data))return ue({},e,i.data.data)}),{revalidate:!1});case 6:t.next=13;break;case 8:if("create"!==r){t.next=13;break}return t.next=11,u.KD.create((0,M.d$)(n||{},c));case 11:(null===(s=t.sent)||void 0===s?void 0:s.data)&&e(u.KD.getListUrl());case 13:case"end":return t.stop()}}),t)}))));case 3:t.next=9;break;case 5:t.prev=5,t.t0=t.catch(0),oe().isAxiosError(t.t0)&&409===(null===(d=t.t0.response)||void 0===d?void 0:d.status)&&l("email",{message:s(D.X3.DUPLICATE_USER)});case 9:case"end":return t.stop()}}),t,null,[[0,5]])})));return function(e){return t.apply(this,arguments)}}();return d}();return(0,a.jsx)("form",{onSubmit:r(n),autoComplete:"off",children:t})},pe={Context:b,ContextProvider:function(e){var t=e.view,r=e.children,n=(0,c.useRouter)(),o=n.query,l=n.push,d=(0,i.S)("users"),f=(0,s.a)(o.userId,{revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnMount:!0,revalidateOnReconnect:!1,refreshWhenHidden:!1});return(0,a.jsx)(b.Provider,{value:p({view:t},f.data?{user:f.data}:{},{mutateUser:f.mutate,isLoading:f.isLoading||f.isError,exitView:function(){return l(u.KD.getListUrl())},model:d}),children:r})},useData:m,Content:function(){var e,t=m(),r=t.user,n=t.model,o=t.isLoading,i=t.view,s=(0,U.$)().t,u=(0,h.cI)({defaultValues:r||{},reValidateMode:"onBlur",mode:"onTouched",resolver:"create"===i?(0,g.X)(y.PE):(0,g.X)(y.JE)}),c=u.reset;return(0,l.useEffect)((function(){r&&c(r)}),[r,c]),(0,a.jsx)(h.RV,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){le(e,t,r[t])}))}return e}({},u,{children:(0,a.jsxs)(fe,{children:[(0,a.jsx)(A.Z,{className:"py-5",items:[{content:(0,w.fm)((null===n||void 0===n?void 0:n.tableName)||""),isLinkTo:"/".concat(null===n||void 0===n||null===(e=n.tableName)||void 0===e?void 0:e.toLowerCase())},{content:s("update"==i?"Update":"Create")}].concat(de("update"===i?[{content:o?(0,a.jsx)(C.Z,{className:"h-4 w-16"}):(0,a.jsx)("p",{className:"text-green-500 underline",children:"update"==i?null===r||void 0===r?void 0:r.id:"Send invite"})}]:[]))}),(0,a.jsxs)("div",{className:"mt-10 items-start justify-between xl:flex",children:[(0,a.jsxs)("div",{className:"relative -mx-3 grid w-full max-w-4xl gap-5 px-3",children:[(0,a.jsx)(E,{}),(0,a.jsx)(N,{})]}),(0,a.jsx)(re,{})]})]})}))}},ve=pe}}]);