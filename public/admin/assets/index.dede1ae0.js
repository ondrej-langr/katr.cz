import{A,a as z,r as i,N as K,u as Q,b as J,c as X,d as ee,s as B,j as e,F as P,t as y,e as j,f as D,g as te,h as f,U as se,i as F,H as oe,k as T,l as I,P as R,m as re,n as $,M as le,o as V,T as W,L as ae,S as ne,p as ie,q as ce,v as de,w as ue,x as H,y as me,I as pe,z as fe,B as he,C as ge,O as xe}from"./index.4d003a77.js";import{B as be}from"./Button.bba1b4d3.js";class Z{static apiGetListUrl(s){return`${A}/folders?path=${s}`}static async create(s){return z.post(`${A}/folders`,{data:{path:s.replaceAll(" ","_")}})}static async update(s,o){}static async delete(s){await z.delete(`${A}/folders`,{params:{path:s}})}}function we(){const t=i.exports.useContext(K);if(!t)throw new Error("@mantine/notifications: use-notifications hook was called outside of NotificationsProvider context");return t}const _=t=>`${A}/folders?path=${t}`,Fe=t=>Q(_(t),{isPaused:()=>!t}),Ne=t=>{const{data:s,isError:o,isLoading:r,mutate:l}=J("files",{path:t}),{data:a,error:c,mutate:h}=Fe(t);return{data:(s==null?void 0:s.data)||a?{files:s==null?void 0:s.data,folders:a}:void 0,isError:o||c,isLoading:r||!c&&!a,mutateFiles:l,mutateFolders:h}},Ce=(t,s)=>s.reduce((o,r)=>({...o,[`${t==="/"?"":t}/${r.name}`]:{file:r,formattedSize:r.size/1e6+"MB",name:r.name.split(".").slice(0,-1).join(),uploaded:!1}}),{}),Y={currentPath:"/",uploadingFiles:{},showNewFolderCreator:!1,workingFolders:{},files:void 0,isError:!1,isLoading:!0,mutateFiles:()=>{},mutateFolders:()=>{},getDropZoneInputProps:()=>{},getDropZoneRootProps:()=>{},openFilePicker:()=>{},updateValue:()=>{}},G=i.exports.createContext(Y),S=()=>i.exports.useContext(G);function ke(t,{name:s,value:o}){return{...t,[s]:o}}const ve=({children:t})=>{const[s,o]=i.exports.useReducer(ke,Y),r=X("folder"),l=ee(),a=i.exports.useMemo(()=>(r||"/").replaceAll("//","/"),[r]),{data:c,isError:h,isLoading:p,mutateFiles:d,mutateFolders:g}=Ne(a),u=i.exports.useCallback((n,m)=>{if(n==="currentPath"){l({search:`?folder=${m}`});return}o({name:n,value:m})},[o,l]),N=i.exports.useCallback(async n=>{const m=Ce(a,n);u("uploadingFiles",m);const C="on-drop-file-info";B({id:C,message:e(P,{children:y("Working")}),title:y("Uploading files..."),color:"blue",autoClose:!1});for(const M in m){const k=m[M];try{await j.create(k.file,{root:a})}catch{D({id:C,message:e(P,{children:y("Error")}),title:y("An error happened"),color:"red",autoClose:2e3})}u("uploadingFiles",Object.fromEntries(Object.entries(m).filter(([E])=>E!==M))),await d(),D({id:C,message:e(P,{children:y("Success")}),title:y("All files has been uploaded"),color:"green",autoClose:2e3})}},[u,a,d]),{getInputProps:x,getRootProps:b,open:w}=te({onDrop:N,noClick:!0,noKeyboard:!0}),v=i.exports.useMemo(()=>({...s,files:c,isError:h,isLoading:p,updateValue:u,openFilePicker:w,getDropZoneRootProps:b,getDropZoneInputProps:x,currentPath:a,mutateFiles:d,mutateFolders:g}),[c,h,p,u,w,b,x,a,d,g,s]);return f(G.Provider,{value:v,children:[e("input",{...x({className:"hidden"})}),t]})},U=({isLast:t,onClick:s,icon:o,title:r,label:l})=>f(P,{children:[f(se,{onClick:s,className:F("flex flex-none items-center",t&&"pointer-events-none"),title:l,children:[e(o,{className:"w-6 text-blue-500"}),r&&e("span",{className:F("ml-2 text-lg font-semibold",t&&"underline"),children:r})]}),!t&&e("span",{className:"mx-2 flex-none text-2xl font-semibold text-gray-300",children:"/"})]}),ye=()=>{const{currentPath:t,updateValue:s}=S(),o=i.exports.useMemo(()=>t.split("/").filter(l=>!!l),[t]),r=i.exports.useCallback(l=>()=>{s("currentPath",l)},[s]);return f("nav",{role:"navigation",className:"flex w-full items-center overflow-auto rounded-2xl border-2 border-project-border bg-white px-4",children:[e(U,{icon:oe,onClick:r("/"),isLast:!o.length}),o.map((l,a)=>e(U,{icon:T,label:"/"+o.slice(0,a+1).join("/"),onClick:r("/"+o.slice(0,a+1).join("/")),title:l,isLast:a===o.length-1},l))]})},Pe=()=>{const{updateValue:t,openFilePicker:s}=S(),{t:o}=I();return e("div",{className:"ml-3 grid aspect-square h-full flex-none",children:f(R,{offset:10,position:"bottom-end",children:[e(R.Target,{children:e(be,{color:"success",className:"flex aspect-square h-full",children:e(re,{size:32,className:"absolute left-3 top-3"})})}),e(R.Dropdown,{children:f($,{children:[e($.Item,{icon:"FilePlus",title:"Add new file to current folder",onClick:s,children:o("Add new file")}),e($.Item,{icon:"FolderPlus",onClick:()=>t("showNewFolderCreator",!0),title:"Add new folder to current folder",children:o("Add new folder")})]})})]})})},Se=()=>f("section",{className:"mb-5 flex h-[55px]",children:[e(ye,{}),e(Pe,{})]}),De=({isOpen:t,onClose:s})=>{const{getDropZoneRootProps:o}=S(),{t:r}=I();return e(le,{opened:t,onClose:s,children:e("div",{...o({className:"flex h-full min-h-[750px] w-full rounded-2xl border-4 border-dashed border-blue-300 bg-gray-100"}),children:e("div",{className:"m-auto text-center",children:e("p",{className:"text-xl font-semibold text-gray-400",children:r("Drag your files here here")})})})})},L=()=>({itemsWrap:F("grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-7 items-start"),itemRoot:F("relative block group"),itemSquare:(t=!0)=>F("aspect-square w-full rounded-lg bg-white shadow-md overflow-hidden relative",t?"group-hover:shadow-lg duration-200":"cursor-default"),itemLabel:F("mt-2 overflow-hidden text-ellipsis font-semibold group-hover:underline")}),q=L(),Ie=({itemId:t,children:s,className:o,...r})=>e(ae,{to:j.getUrl(t),...r,children:s}),Le=({id:t,filename:s,mimeType:o,onDeleteClick:r})=>{var p;const l=s.split(".").at(-1)||"unknown",c=(((p=o==null?void 0:o.split("/"))==null?void 0:p[0])||"unknown")==="image",h=i.exports.useCallback(()=>r(t),[t,r]);return f("article",{className:q.itemRoot,children:[f(Ie,{itemId:t,children:[e("div",{className:q.itemSquare(),children:c?e("img",{alt:"uploaded file",className:"absolute top-0 left-0 h-full w-full object-cover",src:j.getApiRawUrl(t,{w:"250",q:"60"},!0)}):e("div",{className:"flex h-full w-full",children:e("p",{className:"m-auto text-3xl font-bold text-gray-400",children:l})})}),e("h3",{className:q.itemLabel,children:s})]}),e("div",{className:"absolute top-0 right-0 m-2.5",children:e(V,{onClick:h,size:45,color:"red",className:"border-2 border-project-border bg-white",children:e(W,{size:25})})})]})},O=()=>{const t=L();return e(ne,{className:t.itemSquare(!1)})},Me=({itemKey:t,name:s,onClick:o,onDeleteClick:r})=>{var b,w;const{currentPath:l,workingFolders:a}=S(),[c,h]=i.exports.useState(!1),p=L(),d=i.exports.useMemo(()=>`${l==="/"?"":l}/${t}`,[t,l]),g=()=>h(!c),u=i.exports.useMemo(()=>c?T:ie,[c]),N=i.exports.useCallback(()=>o(d),[o,d]),x=i.exports.useCallback(()=>r(d),[r,d]);return f("div",{className:p.itemRoot,onMouseEnter:g,onMouseLeave:g,role:"link",children:[e("div",{className:F(p.itemSquare(),"flex cursor-pointer"),onClick:N,children:e(u,{className:"m-auto block h-28 w-28 text-blue-500"})}),e("h3",{className:F(p.itemLabel,"cursor-pointer text-left"),onClick:N,children:s}),e("div",{className:"absolute top-0 right-0 m-2.5",children:e(V,{onClick:x,size:45,color:"red",className:"border-2 border-project-border bg-white",disabled:((b=a[d])==null?void 0:b.type)==="deleting"||((w=a[d])==null?void 0:w.type)==="uploading",children:e(W,{size:25})})})]})},Ae=({styles:t={}})=>{var x,b;const{updateValue:s,currentPath:o}=S(),{mutate:r}=ce(),l=L(),{t:a}=I(),{register:c,handleSubmit:h,setFocus:p,formState:d,setError:g}=de();i.exports.useEffect(()=>{p("name")},[p]);const u=async({name:w})=>{var v;try{await Z.create(`${o}/${w}`),await r(_(o)),s("showNewFolderCreator",!1)}catch(n){if(H.isAxiosError(n)&&((v=n.response)==null?void 0:v.status)===409)return g("name",{message:"This folder already exists"}),!1;throw n}},N=()=>{d.isSubmitting||s("showNewFolderCreator",!1)};return f("div",{className:F(l.itemRoot,"text-left",d.isSubmitting&&"cursor-wait"),style:t,children:[e("div",{className:F(l.itemSquare(!1),"flex"),children:e(ue,{className:"m-auto h-28 w-28 text-blue-500"})}),f("form",{onSubmit:h(u),className:"relative",children:[e("input",{className:"mt-1 w-full !border-b-4 !border-blue-500 bg-transparent text-lg font-medium outline-0 disabled:opacity-50",disabled:d.isSubmitting||d.isSubmitSuccessful,autoComplete:"off",...c("name",{onBlur:N})}),((b=(x=d.errors)==null?void 0:x.name)==null?void 0:b.message)&&e("small",{className:"b-0 translate-y-full text-lg font-semibold text-red-500",children:a(d.errors.name.message)})]})]})},je=()=>{var w,v;const{isLoading:t,isError:s,files:o,showNewFolderCreator:r,updateValue:l,uploadingFiles:a,workingFolders:c,mutateFiles:h,mutateFolders:p}=S(),d=we(),g=L(),{t:u}=I(),N=i.exports.useCallback(n=>{l("currentPath",n)},[l]),x=i.exports.useCallback(async n=>{var C;const m="Deleting folder";if(B({id:m,loading:!0,title:"Deleting folder",message:u("Deleting your folder..."),autoClose:!1,disallowClose:!0}),confirm(u("Do you really want to delete this folder?"))){const M=n.split("/").at(-1);l("workingFolders",{...c,path:{type:"deleting"}});try{await Z.delete(n),await p(k=>k==null?void 0:k.filter(E=>E!==M)),l("workingFolders",{...c,path:{type:"none"}}),D({id:m,color:"green",message:u("Your folder has been deleted"),autoClose:2e3})}catch(k){if(H.isAxiosError(k)&&((C=k.response)==null?void 0:C.status)===400){D({id:m,color:"red",message:u("This folder is not empty! Delete its contents first"),autoClose:2e3});return}D({id:m,color:"red",message:u("An unexpected error happened"),autoClose:2e3})}}},[c,l,p,u,d]),b=i.exports.useCallback(async n=>{confirm(u("Do you really want to delete this file?"))&&(await j.delete(n),await h(m=>m&&{data:m.data.filter(C=>C.id!==n)}))},[h,u]);return t||s?e("div",{className:g.itemsWrap,children:new Array(10).fill(!0).map((n,m)=>e(O,{},m))}):e(P,{children:((w=o==null?void 0:o.files)==null?void 0:w.length)||((v=o==null?void 0:o.folders)==null?void 0:v.length)||r?e("div",{className:g.itemsWrap,children:f(P,{children:[(o==null?void 0:o.folders)&&o.folders.map(n=>e(Me,{itemKey:n,name:n,onClick:N,onDeleteClick:x},n)),(o==null?void 0:o.files)&&o.files.map(n=>e(Le,{onDeleteClick:b,...n},n.id)),e(me,{mounted:r,transition:"pop-top-left",duration:200,timingFunction:"ease",children:n=>e(Ae,{styles:n})}),Object.entries(a).map(([n])=>e(O,{},n))]})}):e(pe,{})})},Ee=()=>{const[t,s]=i.exports.useState(!1),o=i.exports.useCallback(a=>{var c;a.preventDefault(),!t&&(((c=a==null?void 0:a.dataTransfer)==null?void 0:c.types)||[]).join("")==="Files"&&s(!0)},[t,s]),r=i.exports.useCallback(a=>{a.preventDefault(),t&&s(!1)},[t,s]),l=i.exports.useCallback(()=>s(!1),[s]);return e(ve,{children:f("div",{onDragOver:o,onDrop:r,children:[e(Se,{}),e(je,{}),e(De,{isOpen:t,onClose:l})]})})},qe=()=>{const{t}=I(),s=fe("files");return s?f(ge,{children:[e("div",{className:"flex w-full flex-col justify-between gap-5 py-10 md:flex-row",children:e("h1",{className:"text-3xl font-semibold capitalize",children:t(s.tableName||"")})}),e(Ee,{}),e(xe,{})]}):e(he,{text:t("This model with this id does not exist.")})};export{qe as default};
