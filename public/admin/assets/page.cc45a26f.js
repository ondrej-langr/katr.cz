import{aU as Q,r as i,R as X,a as E,u as Z,aV as ee,aH as te,aW as se,v as ne,aX as ae,ai as oe,m as S,b as re,aY as B,ab as W,x as ie,j as e,al as le,ad as G,aR as ce,h as f,aZ as L,S as ue,k as N,a_ as J,a$ as de,F as me,am as ge,a7 as fe,b0 as T,a5 as z,ay as he,K as V,A as H,T as pe,ae as R,b1 as be,a9 as xe,B as ye,b2 as we,b3 as Ne,b4 as Se}from"./index.bba12bdf.js";const ke=t=>{const{singletons:s}=Q();return i.exports.useMemo(()=>s&&s[t],[t,s])},b=(t=!1)=>{const{singletonId:s}=X(),n=i.exports.useMemo(()=>String(s),[s]),a=ke(n);if(t&&!a)throw new Error("Model not found");return i.exports.useMemo(()=>a?{...a,key:n}:void 0,[n,a])},Ce=(t,s)=>{const n=b(!0),a=i.exports.useCallback(()=>E.singletons.getOne(n.key,t).then(({data:r})=>r.data),[n,t]),c=i.exports.useMemo(()=>[n.key],[n.key]),o=Z([c,t],a,{...s});return i.exports.useMemo(()=>({...o,key:c}),[c,o])},K=i.exports.createContext({setLanguage:()=>{},isLoading:!0,async clear(){}}),j=()=>i.exports.useContext(K),ve=({children:t})=>{var _;const s=ee(),n=te(),a=b(!0),c=i.exports.useMemo(()=>a&&se(a,!0),[a]),o=ne({defaultValues:ae(a),reValidateMode:"onChange",mode:"onTouched",resolver:c&&oe(c)}),{t:r}=S(),[u,C]=i.exports.useState((_=n==null?void 0:n.i18n)==null?void 0:_.default),h=re(),{data:m,isLoading:O,key:v}=Ce({language:u},{refetchInterval:0,refetchOnMount:!0,refetchOnReconnect:!1,refetchOnWindowFocus:!1,refetchIntervalInBackground:!1}),{handleSubmit:P,setError:F}=o,k=i.exports.useCallback(p=>h.setQueryData(v,p),[v]);i.exports.useEffect(()=>{var p;if(m&&(o.reset({...Object.fromEntries(Object.entries(m).filter(([x,g])=>g!==null)),...m.content?{content:JSON.stringify(m.content)}:{}}),s.refs.current))for(const[x,g]of Object.entries(s.refs.current))m[x]&&((p=g==null?void 0:g.blocks)==null||p.render(m[x]))},[m,o]);const l=P(async p=>{var g,w,D;const x=a.key;if(s.refs.current)for(const[y,d]of Object.entries(s.refs.current))await(d==null?void 0:d.isReady),d&&"save"in d&&(p[y]=JSON.stringify(await d.save()));try{await B({title:"Updating",message:r("Updating, please wait..."),successMessage:r("Your entry is updated!")},async()=>{const y=W(m,p),{data:{data:d}}=await E.singletons.update(x,y,{language:u});k(d)})}catch(y){if(ie.isAxiosError(y)&&((w=(g=y.response)==null?void 0:g.data)==null?void 0:w.code)===900409){const d=y.response.data.data;if(Array.isArray(d)&&d.length)for(const I of d){const M=(D=a==null?void 0:a.columns)==null?void 0:D.get(I);let U=I;I==="slug"&&(M==null?void 0:M.type)==="slug"&&(U=M.of),F(U,{message:r("This field is unique and other entry has the same value")})}}}}),A=i.exports.useCallback(async()=>B({message:r("Clearing singleton..."),title:r("Clearing"),errorMessage:r("Failed to clear"),successMessage:r("Clearing successful!")},async()=>{var x,g;const{data:{data:p}}=await E.singletons.clear(a==null?void 0:a.key);if(s.refs.current)for(const w of Object.values(s.refs.current))(g=w==null?void 0:(x=w.blocks).clear)==null||g.call(x);o.reset(p),k(p)}),[k,a,r,s,o.reset]),$=i.exports.useMemo(()=>({language:u,setLanguage:C,data:m,isLoading:O,clear:A}),[u,C,A]);return e(le,{...o,children:e(K.Provider,{value:$,children:e("form",{className:"flex",onSubmit:l,children:t})})})},Me=()=>{var c;const{t}=S(),{language:s,setLanguage:n}=j(),{settings:a}=Q();return((c=a==null?void 0:a.i18n.languages.length)!=null?c:0)<=1?null:e(G,{title:t("Internationalization"),children:e("div",{className:"mx-5 mb-5",children:e(ce,{value:s,onChange:o=>o&&n(o),className:"w-full",shadow:"xl"})})})},q=({className:t,...s})=>e(ue,{className:N("relative top-0.5 inline-block h-4",t),...s}),Y="D.M. YYYY, HH:mm",Oe=()=>{const{data:t,isLoading:s}=j(),{t:n}=S(),a=b();return a!=null&&a.hasTimestamps?e(G,{className:"!pt-0",title:n("Publish info"),children:e("div",{className:"w-full px-4 py-5",children:f("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[f("li",{children:[n("Updated at:")," ",s?e(q,{className:"w-full max-w-[6rem]"}):e("span",{className:"font-semibold text-blue-600",children:t!=null&&t.updated_at?L(t.updated_at).format(Y):n("Not edited yet")})]}),!!(t!=null&&t.created_at)&&f("li",{children:[n("Created at:")," ",s?e(q,{className:"w-full max-w-[6rem]"}):e("span",{className:"font-semibold text-blue-600",children:L(t.created_at).format(Y)})]})]})})}):null},Pe=()=>{const t=b(!0),{isOpen:s}=J();return e("aside",{className:N("sticky top-0 z-10 transition-[width] duration-300",s?"w-[500px]":"h-0 w-0 overflow-hidden"),children:f("div",{className:N("h-full w-[500px] py-5 pl-8 flex flex-col gap-5"),children:[e(Oe,{}),e(Me,{}),e(de,{model:t})]})})},Fe=()=>{const{t}=S(),s=b(!0);return e(me,{children:e(ge,{className:"py-5",items:[{content:t("Singletons")},{content:e("p",{className:"flex-none text-green-500 underline",children:s.title||s.name})}]})})},Ie=()=>{const{name:t,title:s,columns:n}=b(!0),{t:a}=S();return i.exports.useMemo(()=>n&&!!Object.entries(Object.fromEntries(n)).find(([o,r])=>!r.hide&&r.editable&&r.admin.editor.placement===fe.MAIN&&r.type==="string"&&r.admin.fieldType==="heading"),[n])?null:f(T,{children:[f(T.Title,{children:[a("Update")," ",s||t]}),e(T.Divider,{})]})},Te=()=>{const{watch:t}=z(),s=t(),{t:n}=S(),{isOpen:a,setIsOpen:c}=J(),{data:o,clear:r}=j(),u=b(),{setValue:C,formState:h}=z(),m=i.exports.useMemo(()=>!!Object.keys(W(o||{},s)).length,[s,o]),O=async()=>{confirm(n(xe.ON_DELETE_REQUEST_PROMPT))&&await r()},v=()=>{},P=i.exports.useMemo(()=>{let l="";return h.isSubmitting?l="Updating":l="Update",n(l)},[h.isSubmitting,n]),F=i.exports.useMemo(()=>{let l="";return!(u!=null&&u.isDraftable)||!o?l:(o.is_published?l="Unpublish":l="Publish",n(l))},[o,h.isSubmitting,u,n]),k=()=>{C("is_published",o?!o.is_published:!1)};return f(he,{shadow:"lg",component:"footer",className:"align-center container sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between border-2 border-project-border p-3",children:[e(V,{withArrow:!0,label:n("Clean data"),position:"top",color:"gray",children:e(H,{size:"xl",type:"button",loading:h.isSubmitting,onClick:O,color:"red",variant:"light",styles:{root:{width:50,height:50}},className:N(h.isSubmitting&&"!cursor-progress"),children:e(pe,{className:"aspect-square w-10"})})}),f("div",{className:"flex items-center gap-3",children:[(u==null?void 0:u.isDraftable)&&e(R,{size:"sm",variant:"white",type:"submit",disabled:h.isSubmitting,className:"ml-auto",onClick:k,px:"sm",children:F}),e(R,{size:"lg",color:"green",type:"submit",disabled:!m,loading:h.isSubmitting,onClick:v,children:P}),e(V,{withArrow:!0,label:n("Toggle more options"),position:"top",color:"gray",children:e(H,{size:"xl",color:"blue",variant:"light",type:"button",className:N(h.isSubmitting&&"!cursor-progress"),styles:{root:{width:50,height:50}},onClick:()=>c(l=>!l),children:e(be,{className:N("aspect-square w-20 duration-150",a&&"rotate-180")})})})]})]})},Ee=()=>{const t=b(!0);return e(Se,{modelInfo:t})},Ae=({})=>b()?f(ve,{children:[f(we,{children:[e(Fe,{}),f(Ne,{children:[e(Ie,{}),e(Ee,{}),e(Te,{})]})]}),e(Pe,{})]}):e(ye,{});export{Ae as default};
