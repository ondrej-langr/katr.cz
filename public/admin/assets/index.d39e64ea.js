import{A as j,a as X,c as Oe,g as Se,u as Ie,b as _e,d as De,e as Ee,r as i,f as Le,j as s,O as $e,G as Me,B as je,h as f,P as Be,T as Re,C as ze,i as Ae,N as Te,k as qe,l as Ue,m as Ve,n as We,s as ae,F as I,t as S,o as R,p as D,q as Ze,U as He,v as F,H as Ye,w as le,x as E,y as T,z as Ge,D as q,E as ne,I as ie,L as Ke,S as Qe,J as Je,K as Xe,M as et,Q as tt,R as ce,V as ot,W as st,X as rt,Y as at,Z as lt,_ as nt}from"./index.db4443a5.js";import{B as it}from"./Button.1a235a08.js";class de{static apiGetListUrl(t){return`${j}/folders?path=${t}`}static async create(t){return X.post(`${j}/folders`,{data:{path:t.replaceAll(" ","_")}})}static async update(t,o){}static async delete(t){await X.delete(`${j}/folders`,{params:{path:t}})}}var ct=Object.defineProperty,ee=Object.getOwnPropertySymbols,dt=Object.prototype.hasOwnProperty,ut=Object.prototype.propertyIsEnumerable,te=(e,t,o)=>t in e?ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,pt=(e,t)=>{for(var o in t||(t={}))dt.call(t,o)&&te(e,o,t[o]);if(ee)for(var o of ee(t))ut.call(t,o)&&te(e,o,t[o]);return e};const mt={xs:320,sm:380,md:440,lg:620,xl:780};function ft(e){return e?{position:"absolute",top:0,left:0,right:0,bottom:0}:{}}var ht=Oe((e,{overflow:t,size:o,centered:r,zIndex:l,fullScreen:a})=>({close:{},overlay:{display:a?"none":void 0},root:{position:"fixed",zIndex:l,top:0,left:0,right:0,bottom:0},inner:{position:"absolute",top:0,left:0,right:0,bottom:0,overflowY:"auto",padding:a?0:`${e.spacing.xl*2}px ${e.spacing.md}px`,display:"flex",justifyContent:"center",alignItems:r?"center":"flex-start"},title:{marginRight:e.spacing.md,textOverflow:"ellipsis",display:"block",wordBreak:"break-word"},modal:pt({position:"relative",width:a?void 0:e.fn.size({sizes:mt,size:o}),borderRadius:a?0:void 0,outline:0,backgroundColor:e.colorScheme==="dark"?e.colors.dark[7]:e.white,marginTop:r?"auto":void 0,marginBottom:r?"auto":void 0,zIndex:1,marginLeft:"calc(var(--removed-scroll-width, 0px) * -1)"},ft(a)),header:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:e.spacing.md,marginRight:-9},body:{maxHeight:t==="inside"?"calc(100vh - 185px)":null,overflowY:t==="inside"?"auto":null,wordBreak:"break-word"}}));const gt=ht;var xt=Object.defineProperty,B=Object.getOwnPropertySymbols,ue=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable,oe=(e,t,o)=>t in e?xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,bt=(e,t)=>{for(var o in t||(t={}))ue.call(t,o)&&oe(e,o,t[o]);if(B)for(var o of B(t))pe.call(t,o)&&oe(e,o,t[o]);return e},wt=(e,t)=>{var o={};for(var r in e)ue.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&B)for(var r of B(e))t.indexOf(r)<0&&pe.call(e,r)&&(o[r]=e[r]);return o};const vt={size:"md",transitionDuration:250,overflow:"outside",padding:"lg",shadow:"lg",closeOnClickOutside:!0,closeOnEscape:!0,trapFocus:!0,withCloseButton:!0,withinPortal:!0,lockScroll:!0,overlayBlur:0,zIndex:Se("modal")};function me(e){const t=Ie("Modal",vt,e),{className:o,opened:r,title:l,onClose:a,children:c,withCloseButton:h,overlayOpacity:m,size:d,transitionDuration:g,closeButtonLabel:u,overlayColor:v,overflow:x,transition:b,padding:w,shadow:C,radius:n,id:p,classNames:y,styles:O,closeOnClickOutside:N,trapFocus:k,closeOnEscape:V,centered:xe,target:be,withinPortal:we,zIndex:ve,overlayBlur:ye,transitionTimingFunction:Ne,fullScreen:W,unstyled:z,lockScroll:Z}=t,Fe=wt(t,["className","opened","title","onClose","children","withCloseButton","overlayOpacity","size","transitionDuration","closeButtonLabel","overlayColor","overflow","transition","padding","shadow","radius","id","classNames","styles","closeOnClickOutside","trapFocus","closeOnEscape","centered","target","withinPortal","zIndex","overlayBlur","transitionTimingFunction","fullScreen","unstyled","lockScroll"]),A=_e(p),H=`${A}-title`,Y=`${A}-body`,{classes:P,cx:Ce,theme:$}=gt({size:d,overflow:x,centered:xe,zIndex:ve,fullScreen:W},{unstyled:z,classNames:y,styles:O,name:"Modal"}),ke=De(k&&r),Pe=typeof m=="number"?m:$.colorScheme==="dark"?.85:.75,[,G]=Ee(),K=M=>{!k&&M.key==="Escape"&&V&&a()};return i.exports.useEffect(()=>{if(!k)return window.addEventListener("keydown",K),()=>window.removeEventListener("keydown",K)},[k]),Le({opened:r,shouldReturnFocus:k}),s($e,{withinPortal:we,target:be,children:s(Me,{onExited:()=>Z&&G(!1),onEntered:()=>Z&&G(!0),mounted:r,duration:g,exitDuration:g,timingFunction:Ne,transitions:{modal:{duration:g,transition:b||(W?"fade":"pop")},overlay:{duration:g/2,transition:"fade",timingFunction:"ease"}},children:M=>s(je,{...bt({id:A,className:Ce(P.root,o)},Fe),children:f("div",{className:P.inner,onKeyDownCapture:Q=>{var J;((J=Q.target)==null?void 0:J.getAttribute("data-mantine-stop-propagation"))!=="true"&&Q.key==="Escape"&&V&&a()},ref:ke,children:[f(Be,{className:P.modal,shadow:C,p:w,radius:n,role:"dialog","aria-labelledby":H,"aria-describedby":Y,"aria-modal":!0,tabIndex:-1,style:M.modal,unstyled:z,children:[(l||h)&&f("div",{className:P.header,children:[s(Re,{id:H,className:P.title,children:l}),h&&s(ze,{iconSize:16,onClick:a,"aria-label":u,className:P.close})]}),s("div",{id:Y,className:P.body,children:c})]}),s("div",{style:M.overlay,children:s(Ae,{className:P.overlay,sx:{position:"fixed"},zIndex:0,onMouseDown:()=>N&&a(),blur:ye,color:v||($.colorScheme==="dark"?$.colors.dark[9]:$.black),opacity:Pe,unstyled:z})})]})})})})}me.displayName="@mantine/core/Modal";function yt(){const e=i.exports.useContext(Te);if(!e)throw new Error("@mantine/notifications: use-notifications hook was called outside of NotificationsProvider context");return e}const fe=e=>`${j}/folders?path=${e}`,Nt=e=>qe(fe(e),{isPaused:()=>!e}),Ft=e=>{const{data:t,isError:o,isLoading:r,mutate:l}=Ue("files",{path:e}),{data:a,error:c,mutate:h}=Nt(e);return{data:(t==null?void 0:t.data)||a?{files:t==null?void 0:t.data,folders:a}:void 0,isError:o||c,isLoading:r||!c&&!a,mutateFiles:l,mutateFolders:h}},Ct=(e,t)=>t.reduce((o,r)=>({...o,[`${e==="/"?"":e}/${r.name}`]:{file:r,formattedSize:r.size/1e6+"MB",name:r.name.split(".").slice(0,-1).join(),uploaded:!1}}),{}),he={currentPath:"/",uploadingFiles:{},showNewFolderCreator:!1,workingFolders:{},files:void 0,isError:!1,isLoading:!0,mutateFiles:()=>{},mutateFolders:()=>{},getDropZoneInputProps:()=>{},getDropZoneRootProps:()=>{},openFilePicker:()=>{},updateValue:()=>{}},ge=i.exports.createContext(he),_=()=>i.exports.useContext(ge);function kt(e,{name:t,value:o}){return{...e,[t]:o}}const Pt=({children:e})=>{const[t,o]=i.exports.useReducer(kt,he),r=Ve("folder"),l=We(),a=i.exports.useMemo(()=>(r||"/").replaceAll("//","/"),[r]),{data:c,isError:h,isLoading:m,mutateFiles:d,mutateFolders:g}=Ft(a),u=i.exports.useCallback((n,p)=>{if(n==="currentPath"){l({search:`?folder=${p}`});return}o({name:n,value:p})},[o,l]),v=i.exports.useCallback(async n=>{const p=Ct(a,n);u("uploadingFiles",p);const y="on-drop-file-info";ae({id:y,message:s(I,{children:S("Working")}),title:S("Uploading files..."),color:"blue",autoClose:!1});for(const O in p){const N=p[O];try{await R.create(N.file,{root:a})}catch{D({id:y,message:s(I,{children:S("Error")}),title:S("An error happened"),color:"red",autoClose:2e3})}u("uploadingFiles",Object.fromEntries(Object.entries(p).filter(([k])=>k!==O))),await d(),D({id:y,message:s(I,{children:S("Success")}),title:S("All files has been uploaded"),color:"green",autoClose:2e3})}},[u,a,d]),{getInputProps:x,getRootProps:b,open:w}=Ze({onDrop:v,noClick:!0,noKeyboard:!0}),C=i.exports.useMemo(()=>({...t,files:c,isError:h,isLoading:m,updateValue:u,openFilePicker:w,getDropZoneRootProps:b,getDropZoneInputProps:x,currentPath:a,mutateFiles:d,mutateFolders:g}),[c,h,m,u,w,b,x,a,d,g,t]);return f(ge.Provider,{value:C,children:[s("input",{...x({className:"hidden"})}),e]})},se=({isLast:e,onClick:t,icon:o,title:r,label:l})=>f(I,{children:[f(He,{onClick:t,className:F("flex flex-none items-center",e&&"pointer-events-none"),title:l,children:[s(o,{className:"w-6 text-blue-500"}),r&&s("span",{className:F("ml-2 text-lg font-semibold",e&&"underline"),children:r})]}),!e&&s("span",{className:"mx-2 flex-none text-2xl font-semibold text-gray-300",children:"/"})]}),Ot=()=>{const{currentPath:e,updateValue:t}=_(),o=i.exports.useMemo(()=>e.split("/").filter(l=>!!l),[e]),r=i.exports.useCallback(l=>()=>{t("currentPath",l)},[t]);return f("nav",{role:"navigation",className:"flex w-full items-center overflow-auto rounded-2xl border-2 border-project-border bg-white px-4",children:[s(se,{icon:Ye,onClick:r("/"),isLast:!o.length}),o.map((l,a)=>s(se,{icon:le,label:"/"+o.slice(0,a+1).join("/"),onClick:r("/"+o.slice(0,a+1).join("/")),title:l,isLast:a===o.length-1},l))]})},St=()=>{const{updateValue:e,openFilePicker:t}=_(),{t:o}=E();return s("div",{className:"ml-3 grid aspect-square h-full flex-none",children:f(T,{offset:10,position:"bottom-end",children:[s(T.Target,{children:s(it,{color:"success",className:"flex aspect-square h-full",children:s(Ge,{size:32,className:"absolute left-3 top-3"})})}),s(T.Dropdown,{children:f(q,{children:[s(q.Item,{icon:"FilePlus",title:"Add new file to current folder",onClick:t,children:o("Add new file")}),s(q.Item,{icon:"FolderPlus",onClick:()=>e("showNewFolderCreator",!0),title:"Add new folder to current folder",children:o("Add new folder")})]})})]})})},It=()=>f("section",{className:"mb-5 flex h-[55px]",children:[s(Ot,{}),s(St,{})]}),_t=({isOpen:e,onClose:t})=>{const{getDropZoneRootProps:o}=_(),{t:r}=E();return s(me,{opened:e,onClose:t,children:s("div",{...o({className:"flex h-full min-h-[750px] w-full rounded-2xl border-4 border-dashed border-blue-300 bg-gray-100"}),children:s("div",{className:"m-auto text-center",children:s("p",{className:"text-xl font-semibold text-gray-400",children:r("Drag your files here here")})})})})},L=()=>({itemsWrap:F("grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-7 items-start"),itemRoot:F("relative block group"),itemSquare:(e=!0)=>F("aspect-square w-full rounded-lg bg-white shadow-md overflow-hidden relative",e?"group-hover:shadow-lg duration-200":"cursor-default"),itemLabel:F("mt-2 overflow-hidden text-ellipsis font-semibold group-hover:underline")}),U=L(),Dt=({itemId:e,children:t,className:o,...r})=>s(Ke,{to:R.getUrl(e),...r,children:t}),Et=({id:e,filename:t,mimeType:o,onDeleteClick:r})=>{var m;const l=t.split(".").at(-1)||"unknown",c=(((m=o==null?void 0:o.split("/"))==null?void 0:m[0])||"unknown")==="image",h=i.exports.useCallback(()=>r(e),[e,r]);return f("article",{className:U.itemRoot,children:[f(Dt,{itemId:e,children:[s("div",{className:U.itemSquare(),children:c?s("img",{alt:"uploaded file",className:"absolute top-0 left-0 h-full w-full object-cover",src:R.getApiRawUrl(e,{w:"250",q:"60"},!0)}):s("div",{className:"flex h-full w-full",children:s("p",{className:"m-auto text-3xl font-bold text-gray-400",children:l})})}),s("h3",{className:U.itemLabel,children:t})]}),s("div",{className:"absolute top-0 right-0 m-2.5",children:s(ne,{onClick:h,size:45,color:"red",className:"border-2 border-project-border bg-white",children:s(ie,{size:25})})})]})},re=()=>{const e=L();return s(Qe,{className:e.itemSquare(!1)})},Lt=({itemKey:e,name:t,onClick:o,onDeleteClick:r})=>{var b,w;const{currentPath:l,workingFolders:a}=_(),[c,h]=i.exports.useState(!1),m=L(),d=i.exports.useMemo(()=>`${l==="/"?"":l}/${e}`,[e,l]),g=()=>h(!c),u=i.exports.useMemo(()=>c?le:Je,[c]),v=i.exports.useCallback(()=>o(d),[o,d]),x=i.exports.useCallback(()=>r(d),[r,d]);return f("div",{className:m.itemRoot,onMouseEnter:g,onMouseLeave:g,role:"link",children:[s("div",{className:F(m.itemSquare(),"flex cursor-pointer"),onClick:v,children:s(u,{className:"m-auto block h-28 w-28 text-blue-500"})}),s("h3",{className:F(m.itemLabel,"cursor-pointer text-left"),onClick:v,children:t}),s("div",{className:"absolute top-0 right-0 m-2.5",children:s(ne,{onClick:x,size:45,color:"red",className:"border-2 border-project-border bg-white",disabled:((b=a[d])==null?void 0:b.type)==="deleting"||((w=a[d])==null?void 0:w.type)==="uploading",children:s(ie,{size:25})})})]})},$t=({styles:e={}})=>{var x,b;const{updateValue:t,currentPath:o}=_(),{mutate:r}=Xe(),l=L(),{t:a}=E(),{register:c,handleSubmit:h,setFocus:m,formState:d,setError:g}=et();i.exports.useEffect(()=>{m("name")},[m]);const u=async({name:w})=>{var C;try{await de.create(`${o}/${w}`),await r(fe(o)),t("showNewFolderCreator",!1)}catch(n){if(ce.isAxiosError(n)&&((C=n.response)==null?void 0:C.status)===409)return g("name",{message:"This folder already exists"}),!1;throw n}},v=()=>{d.isSubmitting||t("showNewFolderCreator",!1)};return f("div",{className:F(l.itemRoot,"text-left",d.isSubmitting&&"cursor-wait"),style:e,children:[s("div",{className:F(l.itemSquare(!1),"flex"),children:s(tt,{className:"m-auto h-28 w-28 text-blue-500"})}),f("form",{onSubmit:h(u),className:"relative",children:[s("input",{className:"mt-1 w-full !border-b-4 !border-blue-500 bg-transparent text-lg font-medium outline-0 disabled:opacity-50",disabled:d.isSubmitting||d.isSubmitSuccessful,autoComplete:"off",...c("name",{onBlur:v})}),((b=(x=d.errors)==null?void 0:x.name)==null?void 0:b.message)&&s("small",{className:"b-0 translate-y-full text-lg font-semibold text-red-500",children:a(d.errors.name.message)})]})]})},Mt=()=>{var w,C;const{isLoading:e,isError:t,files:o,showNewFolderCreator:r,updateValue:l,uploadingFiles:a,workingFolders:c,mutateFiles:h,mutateFolders:m}=_(),d=yt(),g=L(),{t:u}=E(),v=i.exports.useCallback(n=>{l("currentPath",n)},[l]),x=i.exports.useCallback(async n=>{var y;const p="Deleting folder";if(ae({id:p,loading:!0,title:"Deleting folder",message:u("Deleting your folder..."),autoClose:!1,disallowClose:!0}),confirm(u("Do you really want to delete this folder?"))){const O=n.split("/").at(-1);l("workingFolders",{...c,path:{type:"deleting"}});try{await de.delete(n),await m(N=>N==null?void 0:N.filter(k=>k!==O)),l("workingFolders",{...c,path:{type:"none"}}),D({id:p,color:"green",message:u("Your folder has been deleted"),autoClose:2e3})}catch(N){if(ce.isAxiosError(N)&&((y=N.response)==null?void 0:y.status)===400){D({id:p,color:"red",message:u("This folder is not empty! Delete its contents first"),autoClose:2e3});return}D({id:p,color:"red",message:u("An unexpected error happened"),autoClose:2e3})}}},[c,l,m,u,d]),b=i.exports.useCallback(async n=>{confirm(u("Do you really want to delete this file?"))&&(await R.delete(n),await h(p=>p&&{data:p.data.filter(y=>y.id!==n)}))},[h,u]);return e||t?s("div",{className:g.itemsWrap,children:new Array(10).fill(!0).map((n,p)=>s(re,{},p))}):s(I,{children:((w=o==null?void 0:o.files)==null?void 0:w.length)||((C=o==null?void 0:o.folders)==null?void 0:C.length)||r?s("div",{className:g.itemsWrap,children:f(I,{children:[(o==null?void 0:o.folders)&&o.folders.map(n=>s(Lt,{itemKey:n,name:n,onClick:v,onDeleteClick:x},n)),(o==null?void 0:o.files)&&o.files.map(n=>s(Et,{onDeleteClick:b,...n},n.id)),s(ot,{mounted:r,transition:"pop-top-left",duration:200,timingFunction:"ease",children:n=>s($t,{styles:n})}),Object.entries(a).map(([n])=>s(re,{},n))]})}):s(st,{})})},jt=()=>{const[e,t]=i.exports.useState(!1),o=i.exports.useCallback(a=>{var c;a.preventDefault(),!e&&(((c=a==null?void 0:a.dataTransfer)==null?void 0:c.types)||[]).join("")==="Files"&&t(!0)},[e,t]),r=i.exports.useCallback(a=>{a.preventDefault(),e&&t(!1)},[e,t]),l=i.exports.useCallback(()=>t(!1),[t]);return s(Pt,{children:f("div",{onDragOver:o,onDrop:r,children:[s(It,{}),s(Mt,{}),s(_t,{isOpen:e,onClose:l})]})})},At=()=>{const{t:e}=E(),t=rt("files");return t?f(lt,{children:[s("div",{className:"flex w-full flex-col justify-between gap-5 py-10 md:flex-row",children:s("h1",{className:"text-3xl font-semibold capitalize",children:e(t.tableName||"")})}),s(jt,{}),s(nt,{})]}):s(at,{text:e("This model with this id does not exist.")})};export{At as default};
